<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<body>
  <!-- 所有內容都必須在這個 div 內部 -->
  <div th:fragment="content">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">商品管理</h1>
      <a th:href="@{/products/form}"
         class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300">
        <i class="fas fa-plus mr-2"></i>新增商品
      </a>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">商品名稱</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">價格</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">進貨成本</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">庫存</th>
            <!-- 【優化 1】新增「狀態」欄位 -->
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">狀態</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
          </tr>
        </thead>
        <tbody>
          <!-- 【優化 2】如果商品非 active，為 tr 標籤添加 'inactive-row' class -->
          <tr th:each="product : ${products}" 
              class="border-t hover:bg-gray-50"
              th:classappend="${!product.active} ? 'inactive-row'">
              
            <td class="py-3 px-4" th:text="${product.name}">範例商品</td>
            <td class="py-3 px-4" th:text="${#numbers.formatCurrency(product.price)}">$100.00</td>
            <td class="py-4 px-6" th:text="${#numbers.formatCurrency(product.cost)}">$0.00</td>
            <td class="py-3 px-4" th:text="${product.stockQuantity}">50</td>

            <!-- 【優化 1】根據 active 狀態顯示不同的狀態標籤 -->
            <td class="py-3 px-4">
                <span th:if="${product.active}" class="status-badge status-badge-active">上架中</span>
                <span th:unless="${product.active}" class="status-badge status-badge-inactive">已下架</span>
            </td>

            <td class="py-3 px-4 text-right">
              <!-- 編輯連結：無論是否下架都顯示 -->
              <a th:href="@{/products/form(id=${product.id})}" class="text-blue-500 hover:text-blue-700 mr-4">
                <i class="fas fa-edit"></i> 編輯
              </a>
              
              <!-- 【優化 3】如果商品是 active，顯示「下架」按鈕 -->
              <form th:if="${product.active}" th:action="@{/products/delete/{id}(id=${product.id})}" method="post" class="inline"
                    onsubmit="return confirm('您確定要「下架」此商品嗎？');">
                <button type="submit" class="text-red-500 hover:text-red-700">
                  <i class="fas fa-arrow-down"></i> 下架
                </button>
              </form>

              <!-- 【優化 3】如果商品不是 active，顯示「重新上架」按鈕 -->
              <form th:if="${!product.active}" th:action="@{/products/relist/{id}(id=${product.id})}" method="post" class="inline">
                <button type="submit" class="text-green-500 hover:text-green-700">
                  <i class="fas fa-arrow-up"></i> 重新上架
                </button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
